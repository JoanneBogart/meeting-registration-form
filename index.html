<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>DESC registration form</title>

  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css'>
  <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Raleway:400,400i,700'>
  <style>
    body {
      margin-top: 2%;
      margin-bottom: 0px;
      /* Margin bottom by footer height */
    }

    .outer {
      width: 1000px;
      margin: 0 auto;
    }

    .inner {
      margin-left: 5%;
    }

    .footer {
      margin-top: 40px;
      width: 100%;
      background-color: #f5f5f5;
    }

    #registrationModal .modal-dialog {
      width: 1000px;
      max-width: 2048px;
    }

    .embed-responsive {
      max-height: calc(100vh - 225px);
    }

    /*
#registrationModal .modal-footer {
  justify-content: space-between;
} */
  </style>

</head>

<body>
  <div class="container">
    <h2>Registration for the 2020 DESC Sprint Week</h2>
    <h4>Monday - Friday, Nov. 30 - Dec. 4, 2020</h4>
    There is no registration fee for this meeting.
    <br>
    Please join the LSSTC Slack channel <a href="https://lsstc.slack.com/archives/C2M8FG5A6" target="_blank">#desc-hack-sprint</a> to keep updated on chats, discussions, and announcements during the meeting. You can
    find the list of proposed sprints from this <a href="https://confluence.slac.stanford.edu/display/LSSTDESC/DESC+2020+Virtual+Sprint+Week%3A+Sprints" target="_blank">confluence page</a>.
    <br>
    <br>
    <form action="" method="POST" id="main_form">
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="first_name">First Name</label>
          <input type="text" class="form-control" name="first_name" id="first_name" placeholder="First Name" maxlength="100" required>
          <div class="invalid-feedback">Please provide your first name.</div>
        </div>
        <div class="form-group col-md-6">
          <label for="last_name">Last Name</label>
          <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Last Name" maxlength="100" required>
          <div class="invalid-feedback">Please provide your last name.</div>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" class="form-control" name="email" id="email" placeholder="Email" maxlength="100" required>
        <div class="invalid-feedback">
          Invalid email or already registered.
        </div>
      </div>
      <div class="form-group">
        <label for="affili">Affiliation</label>
        <input type="text" class="form-control" name="affiliation" id="affili" placeholder="Affiliation" maxlength="100" required>
        <div class="invalid-feedback">Please provide your affiliation.</div>
      </div>

      <hr>
      <h5>DESC Meeting Contact Persons</h5>

      As described in the <a href="https://lsstdesc.org/sites/default/files/LSST_DESC_Professional_Conduct.pdf#page=6" target="_blank">DESC Meeting Contact Person Policy</a>, Meeting Contact Persons (MCPs) will be available (by Zoom and Slack) to
      meeting participants and be afforded the authority to take action to resolve disputes, conflicts, or harmful situations.
      MCPs will be selected from eligible participants, and be appointed by the Collaboration Council and the Management Team. All MCP appointments will be confirmed and scheduled with candidates before the meeting.

      <div class="form-group">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="contact" name="contact">
          <label class="form-check-label" for="contact">
            <b>Check if you do NOT wish to be considered for the role of an MCP.</b>
          </label>
        </div>
      </div>

      <hr>
      <h5>Session Facilitators</h5>
      Special opportunity! The virtual sprint week 2020 meeting will be DESCâ€™s first purely virtual sprint event.
      You (as a meeting participant) can help ensure the success of this meeting by enrolling as a Session Facilitator
      for one or two synchronous sessions (like sprint pitches and wrap-ups, or tutorials); this would involve, e.g. time keeping,
      monitoring the chat window or raised hands in the participant list on Zoom, and generally helping where needed. The Meetings
      Accessibility Committee (MAC) will provide reference material(s) prior to the meeting.
      New/junior members are especially encouraged to take advantage of this opportunity as it will help gain familiarity within the DESC community.
      <div class="form-group">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="volunteer" name="volunteer">
          <label class="form-check-label" for="volunteer">
            <b>Yes, I definitely want to help out!</b>
          </label>
        </div>
      </div>

      <hr>

      <h5>Tutorials</h5>
      <p>To help you get started with your sprints, we would like to organize a series of tutorials.
        <br>
        <i>Are there specific topics on which you would like to follow tutorials?</i>
        <br>
        The topics could include DESC-specific ones like DC2, CCL, 3x2pt, etc.;
        or you could browse through the <a href="https://stackclub.readthedocs.io/en/latest/notebooks.html" target='_blank'>LSST Stack Club</a> tutorials
        and request a demonstration of a tutorial that may be relevant for you.<br>
        Don't hesitate to make a suggestion! If it would be useful to you, it would
        most certainly be useful to others.
       </p>
      <div class="form-group">
        <label for="tutorialForm">Tutorial requests/ideas:</label>
        <textarea class="form-control" id="tutorialForm1" rows="3"></textarea>
      </div>

      <hr>

      <h5>Logistics</h5>
      <div class="alert alert-info" role="alert">

        <p>Because of the virtual format of this meeting, several attendance modes
          are possible for you:</p>
        <ul>
          <li><b>Fully synchronous participation</b>: You expect to be available for
            sprint activities for most of the designated sprint timeslot,
            can attend live tutorials, and can join impromptu discussions on Zoom.
          </li>
          <li><b>Fully asynchronous participation</b>: You will be working on sprints
            but on your own schedule, which may not overlap with the designated sprint timeslot.
            You will be able to keep in touch with other sprint participants on GitHub and Slack.</li>
          <li><b>Partially synchronous participation</b>: A mix of the above. You expect to only be
            available for part of the day to join a few live sessions (like tag-ups) and have some
            discussions, but you expect to be working on sprints mostly outside of the designated timeslots.
          </li>
        </ul>
        To help accomodate participants from both sides of the Atlantic, we propose two sprinting hubs: one centered on Central European Standard Time, and
        the other one on Pacific Standard Time.
        <ul>
          <li> <b>American Sprint Time</b>: 8am-2pm PST, or equivalently 11am-5pm EST
          </li>
          <li> <b>European Sprint Time</b>: 1pm-7pm CEST
          </li>
        </ul>
        These two regional sprint timeslots will overlap each day for 2 hours, allowing for some globally synchronous discussions and events.
        Please check the <a href="https://confluence.slac.stanford.edu/display/LSSTDESC/DESC+2020+Virtual+Sprint+Week%3A+Logistics" target="_blank">Logistics Page</a> for more information.
      </div>
      <div class="form-group">
        <label for="inputAttendance">What days will you attend and which sprint mode are you most likely to follow?</label>
        <div class="input-group mb-3" id="inputAttendance">
          <div class="input-group-prepend">
            <label class="input-group-text" for="attend_mon">Monday</label>
          </div>
          <select class="custom-select" name="attend_mon" id="attend_mon" required>
            <option selected value="0">Choose...</option>
            <option value="1">Fully Synchronous</option>
            <option value="2">Partially Synchronous</option>
            <option value="3">Fully Asynchronous</option>
            <option value="4">Not attending that day</option>
          </select>
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <label class="input-group-text" for="attend_tue">Tuesday</label>
          </div>
          <select class="custom-select" name="attend_tue" id="attend_tue" required>
            <option selected value="0">Choose...</option>
            <option value="1">Fully Synchronous</option>
            <option value="2">Partially Synchronous</option>
            <option value="3">Fully Asynchronous</option>
            <option value="4">Not attending that day</option>
          </select>
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <label class="input-group-text" for="attend_wed">Wednesday</label>
          </div>
          <select class="custom-select" name="attend_wed" id="attend_wed" required>
            <option selected value="0">Choose...</option>
            <option value="1">Fully Synchronous</option>
            <option value="2">Partially Synchronous</option>
            <option value="3">Fully Asynchronous</option>
            <option value="4">Not attending that day</option>
          </select>
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <label class="input-group-text" for="attend_thu">Thursday</label>
          </div>
          <select class="custom-select" name="attend_thu" id="attend_thu" required>
            <option selected value="0">Choose...</option>
            <option value="1">Fully Synchronous</option>
            <option value="2">Partially Synchronous</option>
            <option value="3">Fully Asynchronous</option>
            <option value="4">Not attending that day</option>
          </select>
        </div>
        <div class="input-group mb-3">
          <div class="input-group-prepend">
            <label class="input-group-text" for="attend_fri">Friday</label>
          </div>
          <select class="custom-select" name="attend_fri" id="attend_fri" required>
            <option selected value="0">Choose...</option>
            <option value="1">Fully Synchronous</option>
            <option value="2">Partially Synchronous</option>
            <option value="3">Fully Asynchronous</option>
            <option value="4">Not attending that day</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="inputTimezone">Which timezone are you the closest to and will be sprinting from?</label>
        <div id="inputTimezone">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="timezone" id="tz_pst" value="pst" required>
            <label class="form-check-label" for="tz_pst">Pacific Standard Time</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="timezone" id="tz_est" value="est" required>
            <label class="form-check-label" for="tz_est">Eastern Standard Time</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="timezone" id="tz_cest" value="cest" required>
            <label class="form-check-label" for="tz_cest">Central European Standard Time</label>
          </div>
        </div>
      </div>

      <div class="alert alert-warning" role="alert">
        Having a working computing account at the National Energy Research Scientific Computing Center (NERSC)
        <b>before</b> the sprint week is <b>highly</b> recommended. This will let you access the shared
        DESC computing environment and DESC data products. <br>
        Information about accessing NERSC resources is available on the DESC <a href="https://confluence.slac.stanford.edu/display/LSSTDESC/Getting+Started+at+NERSC" target="_blank">Confluence</a>.
      </div>

      <div class="form-group">
        <label for="inputNERSC">Do you have a working NERSC account and can access the JupyterHub platform?</label>
        <div>
          <div class="form-check form-check-inline" id="inputNersc">
            <input class="form-check-input" type="radio" name="nersc" id="nersc_ok" value="ok" required>
            <label class="form-check-label" for="nersc_ok">Yes, I can access JupyterHub without problem</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="nersc" id="nersc_notok" value="notok" required>
            <label class="form-check-label" for="nersc_notok">No/I'm not sure, I would appreciate some help to get started</label>
          </div>
        </div>
      </div>

      <hr>
      <div class="form-group">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="recording" id="recording" required>
          <label class="form-check-label" for="recording">
            Some sessions will be recorded and recordings will be posted to DESC Confluence. As a presenter or participant of the meeting, I understand that what I say, with my microphone turned on, may be recorded.
          </label>
          <div class="invalid-feedback">Please acknowledge that you may be recorded.</div>
        </div>
      </div>
      <div class="form-group">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="code_of_conduct" id="code_of_conduct" required>
          <label class="form-check-label" for="code_of_conduct">
            I have read, and will abide by, the <a href="https://lsstdesc.org/assets/pdf/policies/LSST_DESC_Professional_Conduct.pdf" target="_blank">DESC Meeting Code of Conduct</a>.
          </label>
          <div class="invalid-feedback">You must agree to the code of conduct before registering.</div>
        </div>
      </div>
      <div class="form-group" id="register_button">
        <button id="register" class="btn btn-primary" type="button">Register</button>
        <small class="form-text text-muted">Please disable adblockers if you encounter any difficulties with completing the registration.</small>
      </div>
      <input type="hidden" name="secret" id="secret" value="" />
    </form>
  </div>

  <!-- Modal Warning-->
  <div class="modal fade" id="backendModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Invalid registration URL</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>The URL for this form does not contain a valid registration link.
            Please contact the Logistics Organizing Committee (LOC) for a valid registration URL.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal fade" id="confirmationModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Registration successful</h5>
        </div>
        <div class="modal-body" id="confirmation-content">
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <dl class="row">
        <span class="text-muted">
          <p class="lead">Privacy notice</p>
          <p>Your <mark>first name, last name, and affiliation will appear on a public webpage</mark> associated with the meeting website. Your email will be used to contact you when necessary. All data collected here may be shared with LSST DESC
            members who are on the Logistics Organizing Committee (LOC), the Scientific Organizing Committee (SOC), the Meetings Committee, the Collaboration Council, and the Management Team.
          </p>
      </dl>
    </div>
  </footer>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js'></script>
  <script>
    // Callback to validate registration
    var checkoutCallback = function() {
      // Manually submit form data using Ajax and display confirmation modal
      $.ajax({
        type: 'POST',
        data: $("#main_form").serialize(),
        url: $("#main_form").attr('action'),
        success: function(data) {
          $("#confirmation-content").html(data);
          $("#confirmationModal").modal({
            show: true,
            backdrop: 'static',
            keyboard: false
          });
        }
      });

    };

    document.getElementById("register").onclick = function(e) {
      checkoutCallback()

      e.preventDefault();
      return false;
    }

    // Validate the form before authorising checkout
    $(function() {
      document.getElementById("register_button").addEventListener("click", function(event) {
        var form = document.getElementById("main_form");

        // If form is not validated, don't trigger the registration
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, true);
    });

    // Function to disable the form if the backend is unavailable
    var getUrlParameter = function getUrlParameter(sParam) {
      var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

      for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
          return sParameterName[1] === undefined ? true : sParameterName[1];
        }
      }
    };

    var backend = getUrlParameter('backend');
    var secret = getUrlParameter('secret');

    $(function() {
      // Disable the form if the required info about backend server is missing
      if ((backend === undefined) || (secret === undefined)) {
        $("#main_form :input").prop('disabled', true);
        $('#backendModal').modal({
          show: true,
          backdrop: 'static',
          keyboard: false
        });
      }
      $("#main_form").attr('action', backend + '/register');
      $("#secret").attr('value', secret);
    });

    $("#email").change(function() {
      $.post(backend + "/check_email", {
          email: $(this).val(),
          secret: secret
        },
        function(data, status) {
          var d = document.getElementById("email");
          if (status === "success") {
            if (data === "Ok") {
              d.setCustomValidity("");
              d.classList.remove('is-invalid');
            } else {
              d.setCustomValidity("Already registered.");
              d.classList.add('is-invalid');
            }
          } else {
            // Server is unavailable...
            // make sure we don't block the form at this stage
            d.setCustomValidity("");
            d.classList.remove('is-invalid');
          }
          console.log("Data: " + data + "\nStatus: " + status);
        });
    });

    $("input").keyup(function() {
      var target = $("#" + $(this).attr("id") + "-s");
      target.text($(this).val());
      target.css("font-size", "100%");
      var badge = $("#badge");
      var scale = badge.width() / target.width();
      if (scale < 1) target.css("font-size", (scale * 100).toString() + "%");
    });
  </script>

</body>

</html>
